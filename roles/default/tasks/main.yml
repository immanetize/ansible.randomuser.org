- include: ssh_port_test.yml
- setup:
- include: firewall.yml
- include: setenforce1.yml
  when: 
    ( ansible_selinux.status == "disabled" )
- debug: var=ansible_selinux.status 
- name: install convenient packages
  package:
    name: "{{item}}"
    state: latest
  with_items:
    - vim-enhanced
    - lsof
    - strace
    - nmap
    - rsync
    - tcpdump
- name: create facts dir
  file:
    path: /etc/ansible/facts.d
    mode: 0700
    state: directory
- name: ensure permissive
  lineinfile:
    regexp: '^(SELINUX=).*'
    backrefs: yes
    line: '\1permissive'
    path: /etc/sysconfig/selinux
  notify: 
    - trigger autorelabel
    - reboot
- include: change_ssh_port.yml
  when: ansible_ssh_port == 22
- name: apply interface zoning
  firewalld:
    immediate: yes
    interface: "{{ item.name }}"
    permanent: yes
    zone: "{{ item.zone }}"
    state: enabled
  with_items: "{{ interfaces }}"
  when: item.zone is defined

