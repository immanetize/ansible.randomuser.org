{% for region in networks_by_region %}
shared-network {{ region }} {
	max-lease-time 6000;
	default-lease-time 3600;
  {% for network in networks_by_region[region] %}
  subnet {{ network['subnet']| ipaddr('network') }} netmask {{ network['subnet'] | ipaddr('netmask') }} {
		authoritative;
    option domain-name-servers 10.27.0.89; 
    {% if network['gateway'] is defined %}
		option routers {{ network['gateway'] }};
    {% endif %}
		option domain-name "randomuser.org";
    pool {
      range {{ network['subnet'] | ipaddr('network') | ipaddr('64') }} {{ network['subnet'] | ipaddr('200') |ipaddr('network') }};
      {% if 'guest' in network.name %}
      allow unknown-clients;
      deny known-clients;
      {% else %}
      deny unknown-clients;
      allow known-clients;
      {% endif %}
    }
  }
  {% endfor %}
}
{% endfor %}
{% for group in groups %}
class "{{ group }}" {
  match hardware;
  }
{% endfor %}
{% for host in groups['all'] %}
  {% if hostvars[host]['mac_address'] is defined %}
  host {{ host }}.{{ domain }} {
    hardware ethernet {{ hostvars[host]['mac_address']| default('') }}
  };
  {% endif %}
{% endfor %}  
